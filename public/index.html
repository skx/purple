<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Alerts [0/0/0]</title>
    <meta http-equiv="refresh" content="55">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <style type="text/css">
.steve-footer {
      padding: 40px 0;
      color: #999;
      background-color: #f9f9f9;
      border-top: 1px solid #e5e5e5;
      }
      .steve-footer .nav-header {
      color: black;
      font-weight: bold;
      }
      .steve-footer p:last-child {
      margin-bottom: 0;
      }
    </style>

    <script type="text/javascript">
      window.onload = function(){
      if (location.hash !== '') $('a[href="' + location.hash + '"]').tab('show');
      $('a[data-toggle="tab"]').bind('click', function(e) {
      location.hash = $(e.target).attr('href').substr(1);
      }
      );

      $( "table" ).delegate( "tr",  "click", function(  ) {
         $(this).next().slideToggle(); } );
      }
    </script>
    <script type="text/javascript">
      (function() {


      $.getJSON( "/events" , function( data ) {
      var h = {};
      h['raised'] = 0
      h['pending'] = 0
      h['cleared'] = 0

      $.each( data, function( key, val ) {

      // Bump the count of this type of alerts, so we can update the title.
      var status = val['status'];
      h[status] = h[status]+1

      // This is horrid - we want to show either "will raise at",
      // "last notified at", or nothing depending on the type.
      if ( status == "raised" ) {

          var d = Math.round( val['notified_at'] * 1000)
          d = parseFloat(d);
          d = new Date( d  );

      $("#" + val['status'] + "_alerts").find('tbody')
          .append($('<tr>')
        .append($('<td>')
          .append(val['status'])
          )
          .append($('<td>')
          .append(val['source'])
          )
          .append($('<td>')
          .append(val['subject'])
          )
          .append($('<td>')
          .append(d)
          )
          .append($('<td>')
          .append("<a href=\"/clear/" + (val['i']) + "\">clear</a>")
          )
          );
          // Add the detail - hidden by default
          $("#" + val['status'] + "_alerts").find('tbody')
          .append("<tr style=\"display:none;\"><td></td><td colspan=\"4\"><p>" + val['detail'] + "</p></td></tr>")
       }
      if ( status == "pending" ) {

          var d = Math.round( val['raise_at'] * 1000)
          d = parseFloat(d);
          d = new Date( d  );


          $("#" + val['status'] + "_alerts").find('tbody')
          .append($('<tr>')
        .append($('<td>')
          .append(val['status'])
          )
          .append($('<td>')
          .append(val['source'])
          )
          .append($('<td>')
          .append(val['subject'])
          )
          .append($('<td>')
          .append(d)
          )
          .append($('<td>')
          .append("<a href=\"/clear/" + (val['i']) + "\">clear</a>")
          )
          );


          // Add the detail - hidden by default
          $("#" + val['status'] + "_alerts").find('tbody')
          .append("<tr style=\"display:none;\"><td></td><td colspan=\"4\"><p>" + val['detail'] + "</p></td></tr>")
      }
      if ( status == "cleared" ) {

        $("#" + val['status'] + "_alerts").find('tbody')
          .append($('<tr>')
        .append($('<td>')
          .append(val['status'])
          )
          .append($('<td>')
          .append(val['source'])
          )
          .append($('<td>')
          .append(val['subject'])
          )
          .append($('<td>')
          .append("<a href=\"/clear/" + (val['i']) + "\">clear</a>")
          )
          );

          // Add the detail - hidden by default
          $("#" + val['status'] + "_alerts").find('tbody')
          .append("<tr style=\"display:none;\"><td></td><td colspan=\"4\"><p>" + val['detail'] + "</p></td></tr>")
       }


          // Set the title.
          document.title = "Alerts [" + h['raised'] + "/" + h['pending'] + "/" + h['cleared'] + "]";

          });
          });
          })();
    </script>

  </head>
  <body>
<div class="wrapper">

    <div class="container">
      <h2>Alerts</h2>
      <ul class="nav nav-tabs" id="myTab">
        <li class="active"><a data-toggle="tab" href="#raised">Raised</a></li>
        <li><a data-toggle="tab" href="#pending">Pending</a></li>
        <li><a data-toggle="tab" href="#cleared">Cleared</a></li>
      </ul>

      <div class="tab-content">
        <div id="raised" class="tab-pane fade in active">
          <p>&nbsp;</p>
          <table id="raised_alerts" class="table table-striped table-hover table-bordered table-condensed" >
            <tr><th>Status</th><th>Source</th><th>Subject</th><th>Last Notified</th><th>Actions</th></tr>
          </table>
        </div>
        <div id="pending" class="tab-pane fade">
          <p>&nbsp;</p>
          <table id="pending_alerts" class="table table-striped table-hover table-bordered table-condensed" >
            <tr><th>Status</th><th>Source</th><th>Subject</th><th>Raise Time</th><th>Actions</th></tr>
          </table>
        </div>
        <div id="cleared" class="tab-pane fade">
          <p>&nbsp;</p>
          <table id="cleared_alerts" class="table table-striped table-hover table-bordered table-condensed" >
            <tr><th>Status</th><th>Source</th><th>Subject</th><th>Actions</th></tr>
          </table>
        </div>
      </div>
    </div>
</div>
    <footer id="footer" class="footer navbar-fixed-bottom steve-footer" role="navigation">
      <div class="container">
        <div class="col-md-6">
          <ul class="nav ">
            <ul class="nav ">
              <li class="nav-header">Source Code</li>
              <li><a href="https://github.com/skx/purple">Available on github</a></li>
            </ul>
        </div>
        <div class="col-md-6">
          <ul class="nav ">
            <li class="nav-header">Copyright</li>
            <li>@ Steve Kemp</li>
          </ul>
        </div>
      </div>
    </footer>

  </body>
</html>
